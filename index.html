<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>talk to me</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #000000;
      font-family: 'Segoe UI', sans-serif;
      color: #ffffff;
    }

    #bg-video {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      object-fit: cover;
      z-index: -1;
    }

    .card {
      background: none;
      border: none;
      padding: 40px;
      width: 100%;
      max-width: 480px;
      text-align: center;
    }

    .led-preview {
      background: transparent;
      border: none;
      border-radius: 0;
      padding: 16px;
      margin-bottom: 32px;
      text-align: center;
      overflow: hidden;
      position: relative;
      min-height: 60px;
    }

    .led-preview span {
      display: inline-block;
      font-family: 'Courier New', monospace;
      font-size: 22px;
      font-weight: bold;
      white-space: nowrap;
      animation: scroll-text 10s linear infinite;
    }

    @keyframes scroll-text {
      0%   { transform: translateX(100%); }
      100% { transform: translateX(-100%); }
    }

    h1 {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 8px;
      color: #ffffff;
      letter-spacing: 0.05em;
    }

    p.subtitle {
      font-size: 0.85rem;
      color: #ffffff;
      margin-bottom: 40px;
    }

    label {
      display: block;
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #ffffff;
      margin-bottom: 6px;
    }

    input[type="text"] {
      width: 100%;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 0;
      padding: 12px 14px;
      font-size: 1rem;
      color: #ffffff;
      margin-bottom: 6px;
      outline: none;
      transition: border-color 0.2s;
    }

    input[type="text"]:focus {
      border-color: var(--highlight, #ff2200);
    }

    .char-count {
      font-size: 0.75rem;
      color: #ffffff;
      text-align: right;
      margin-bottom: 18px;
    }

    .char-count.warning { color: var(--highlight, #ff2200); }

    select {
      width: 100%;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 0;
      padding: 12px 14px;
      font-size: 1rem;
      color: #ffffff;
      margin-bottom: 24px;
      outline: none;
      cursor: pointer;
      appearance: none;
      transition: border-color 0.2s;
    }

    select:focus {
      border-color: var(--highlight, #ff2200);
    }

    button {
      width: 100%;
      padding: 13px;
      background: transparent;
      color: var(--highlight, #ff2200);
      border: 2px solid var(--highlight, #ff2200);
      border-radius: 0;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
    }

    button:hover { background: rgba(255, 255, 255, 0.1); }
    button:active { transform: scale(0.98); }
    button:disabled { border-color: #444; color: #444; cursor: not-allowed; }

    .status {
      margin-top: 16px;
      font-size: 0.85rem;
      text-align: center;
      min-height: 20px;
      color: #ffffff;
    }

    .status.success { color: #4caf50; }
    .status.error   { color: #f44336; }
  </style>
</head>
<body>

<video id="bg-video" autoplay muted loop playsinline>
  <source src="https://upload.wikimedia.org/wikipedia/commons/6/62/Phone_Booth_-_Tokyo_-_Feb_27_2021.webm" type="video/webm" />
</video>

<audio id="bg-audio" loop>
  <source src="https://upload.wikimedia.org/wikipedia/commons/9/9d/Cebu_City_at_night.ogg" type="audio/ogg" />
</audio>

<button id="audio-btn" onclick="toggleAudio(event)" title="Toggle music" style="
  position: fixed;
  bottom: 16px;
  right: 16px;
  z-index: 10;
  background: transparent;
  border: none;
  color: rgba(255,255,255,0.4);
  font-size: 1.2rem;
  cursor: pointer;
  padding: 4px;
  line-height: 1;
  transition: color 0.2s;
" onmouseover="this.style.color='rgba(255,255,255,0.9)'" onmouseout="this.style.color='rgba(255,255,255,0.4)'">♪</button>

<script>
  const audio = document.getElementById("bg-audio");
  const btn   = document.getElementById("audio-btn");
  audio.volume = 0.2;
  let started = false;

  // Start audio on first interaction with anything on the page
  document.addEventListener("click", function startAudio() {
    if (!started) {
      audio.play();
      started = true;
    }
  });

  window.toggleAudio = function(e) {
    e.stopPropagation(); // prevent the click from double-triggering startAudio
    if (audio.muted) {
      audio.muted = false;
      btn.textContent = "♫";
    } else {
      audio.muted = true;
      btn.textContent = "♪";
    }
  };
</script>

<div class="card">
  <div class="led-preview">
    <span id="preview-text" style="color: #ff2200; text-shadow: 0 0 8px #ff2200;"></span>
  </div>

  <h1>Send Me Your Words</h1>
  <p class="subtitle">Send a message to the screen...</p>

  <label for="name">Your Name</label>
  <input type="text" id="name" placeholder=" " maxlength="50" oninput="updatePreview()" />
  <div class="char-count" id="name-char-count">0 / 50</div>

  <label for="message">Message</label>
  <input type="text" id="message" placeholder=" " maxlength="200" oninput="updatePreview()" />
  <div class="char-count" id="message-char-count">0 / 200</div>

  <label for="color">Text Color</label>
  <select id="color" onchange="updatePreview()">
    <option value="red">Red</option>
    <option value="orange">Orange</option>
    <option value="yellow">Yellow</option>
    <option value="green">Green</option>
    <option value="cyan">Cyan</option>
    <option value="blue">Blue</option>
  </select>

  <button id="submit-btn" onclick="submitMessage()">Send to Board</button>
  <div class="status" id="status"></div>
</div>

<!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
  import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBDH2JIvcXxsmMwIdJzO6JGKvZ41zwuTPs",
    authDomain: "messageboard-d53f7.firebaseapp.com",
    projectId: "messageboard-d53f7",
    storageBucket: "messageboard-d53f7.firebasestorage.app",
    messagingSenderId: "51453655338",
    appId: "1:51453655338:web:9408482b4c47e6f5f28653"
  };

  const COLOR_MAP = {
    red:    [255, 0,   0],
    orange: [255, 140, 0],
    yellow: [255, 255, 0],
    green:  [0,   255, 0],
    cyan:   [0,   255, 255],
    blue:   [0,   100, 255],
  };

  const CSS_COLOR_MAP = {
    red:    "#ff2200",
    orange: "#ff8800",
    yellow: "#ffff00",
    green:  "#00ff00",
    cyan:   "#00ffff",
    blue:   "#0088ff",
  };

  const app = initializeApp(firebaseConfig);
  const db  = getFirestore(app);

  window.submitMessage = async function () {
    const nameEl    = document.getElementById("name");
    const messageEl = document.getElementById("message");
    const statusEl  = document.getElementById("status");
    const btn       = document.getElementById("submit-btn");
    const colorName = document.getElementById("color").value;

    const name    = nameEl.value.trim();
    const message = messageEl.value.trim();
    const color   = COLOR_MAP[colorName];

    if (!name) {
      statusEl.className = "status error";
      statusEl.textContent = "Please enter your name.";
      return;
    }
    if (!message) {
      statusEl.className = "status error";
      statusEl.textContent = "Please enter a message.";
      return;
    }

    btn.disabled = true;
    statusEl.className = "status";
    statusEl.textContent = "Sending...";

    try {
      await addDoc(collection(db, "messages"), {
        name:       name,
        message:    message,
        color_r:    color[0],
        color_g:    color[1],
        color_b:    color[2],
        updated_at: serverTimestamp()
      });
      statusEl.className = "status success";
      statusEl.textContent = "✓ Message sent to the board!";
      nameEl.value = "";
      messageEl.value = "";
      document.getElementById("preview-text").textContent = "";
      document.getElementById("name-char-count").textContent = "0 / 50";
      document.getElementById("message-char-count").textContent = "0 / 200";
    } catch (err) {
      statusEl.className = "status error";
      statusEl.textContent = "Error: " + err.message;
      console.error(err);
    }

    btn.disabled = false;
  };

  window.updatePreview = function () {
    const name        = document.getElementById("name").value.trim();
    const message     = document.getElementById("message").value.trim();
    const colorName   = document.getElementById("color").value;
    const cssColor    = CSS_COLOR_MAP[colorName];
    const previewEl   = document.getElementById("preview-text");

    const nameCount    = document.getElementById("name").value.length;
    const messageCount = document.getElementById("message").value.length;

    const nameCountEl    = document.getElementById("name-char-count");
    const messageCountEl = document.getElementById("message-char-count");

    nameCountEl.textContent    = nameCount + " / 50";
    messageCountEl.textContent = messageCount + " / 200";
    nameCountEl.className    = "char-count" + (nameCount > 40 ? " warning" : "");
    messageCountEl.className = "char-count" + (messageCount > 160 ? " warning" : "");

    previewEl.style.color      = cssColor;
    previewEl.style.textShadow = `0 0 8px ${cssColor}`;
    document.documentElement.style.setProperty('--highlight', cssColor);

    if (name && message) {
      previewEl.textContent = name + ": " + message;
    } else if (name) {
      previewEl.textContent = name + ": ...";
    } else if (message) {
      previewEl.textContent = "...: " + message;
    } else {
      previewEl.textContent = "";
    }
  };
</script>

</body>
</html>
